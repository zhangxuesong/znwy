<form action="" class="form-horizontal form" method="post" role="form" enctype="multipart/form-data" id="myform" >
	<input type="hidden" name="token" value="{$_W['token']}" />	
	<input type="hidden" name="id" id="id" value="{$item['id']}" />	
    
	{if $_W['uid']} 
	<div class="form-group">
		<label class="col-xs-12 col-sm-2 col-md-2 control-label"> <span class="text-danger">*</span>所属物业</label>
		<div class="col-sm-8 col-lg-9 col-xs-12">
			<select class="form-control"  name="pid" id="pid" onchange="renderCategory(this,'region','rid')">
				{if $item['cname'] }
					<option value="{$item['cid']}">{$item['cname']}</option>
				{else}
					<option value="0">请选择所属物业</option>
				{/if}
				{loop $myproperty $k $v}
					<option value="{$v['id']}" {if $item['pid'] == $v['id']} selected {/if} >{$v['title']}</option>
				{/loop}
			</select>				
		</div>
	</div>
	{else}
		<input type="hidden" class="form-control" id="pid" value="{$mywe['pid']}" name="pid" />
	{/if}

	<div class="form-group">
		<label class="col-xs-12 col-sm-2 col-md-2 control-label"><span class="text-danger">*</span>所属主体</label>
		<div class="col-sm-8 col-lg-9 col-xs-12">
			<select class="form-control" id="rid" name="rid" onchange="renderCategory(this,'location','lid')" onclick="changeHeader(this,'headper','hid')">
				{if $item['rname'] }
					<option value="{$item['rid']}">{$item['rname']}</option>
				{else}
					<option value="0">请选择所属主体</option>
				{/if}
				{loop $eregions $i $r}
					<option value="{$r['id']}" {if $item['rid'] == $r['id']} selected {/if} >{$r['title']}</option>
				{/loop}
				{if $_W['uid']} 
				{else}
					{if $operation=='patroladd'}
						{loop $regions $i $r}
							<option value="{$r['id']}" {if $item['rid'] == $r['id']} selected {/if} >{$r['title']}</option>
						{/loop}
					{/if}
				{/if}
			</select>
		</div>
	</div>	

	<div class="form-group">
		<label class="col-xs-12 col-sm-2 col-md-2 control-label">区域</label>
		<div class="col-sm-8 col-lg-9 col-xs-12">
			<select class="form-control" id="lid" name="lid" onchange="renderCategory(this,'building','bid')">
				
				{if $item['lname'] }
					<option value="{$item['lid']}">{$item['lname']}</option>
				{else}
					<option value="0">请选择区域</option>
				{/if}	
				{loop $elocations $location}
					<option value="{$location['id']}" {if $item['lid'] == $location['id']} selected {/if} >{$location['title']}</option>
				{/loop}			
			</select>
		</div>
	</div>
			
	<!-- <div class="form-group">
		<label class="col-xs-12 col-sm-2 col-md-2 control-label">楼宇</label>
		<div class="col-sm-8 col-lg-9 col-xs-12">
			<select class="form-control" id="bid" name="bid" onchange="renderCategory(this,'unit','tid')">
				{if $item['bname'] }
					<option value="{$item['bid']}">{$item['bname']}</option>
				{else}
					<option value="0">请选择楼宇</option>
				{/if}	
				{loop $ebuildings $j $d}
					<option value="{$d['id']}" {if $item['bid'] == $d['id']} selected {/if} >{$d['title']}</option>
				{/loop}			
			</select>
		</div>
	</div> -->

	<!-- <div class="form-group">
		<label class="col-xs-12 col-sm-2 col-md-2 control-label">单元</label>
		<div class="col-sm-8 col-lg-9 col-xs-12">
			<select class="form-control" id="tid" name="tid" >
				{if $item['tname'] }
					<option value="{$item['tid']}">{$item['tname']}</option>
				{else}
					<option value="0">请选择单元</option>
				{/if}
				{loop $eunits $m $t}
					<option value="{$t['id']}" {if $item['tid'] == $t['id']} selected {/if} >{$t['title']}</option>
				{/loop}				
			</select>
		</div>
	</div> -->

	<div class="form-group">
		<label class="col-xs-12 col-sm-2 col-md-2 control-label"><span class="text-danger">*</span>负责人</label>
		<div class="col-sm-8 col-lg-9 col-xs-12">
			<select class="form-control" id="hid" name="hid" >
				{if $item['hname'] }
					<option value="{$item['hid']}">{$item['hname']}</option>
				{else}
					<option value="0">请选择负责人</option>
				{/if}
				{loop $headpers $h $r}
					<option value="{$r['id']}" {if $item['hid'] == $r ['id']} selected {/if} >{$r['title']}</option>
				{/loop}				
			</select>
		</div>	
	</div>

	<div class="form-group">
		<label class="col-xs-12 col-sm-2 col-md-2 control-label">植被编号</label>
		<div class="col-sm-8 col-lg-9 col-xs-12">
			<input type="text" class="form-control" id="vegeid" value="{$item['vegeid']}" name="vegeid" />
		</div>
	</div>

	<div class="form-group">
		<label class="col-xs-12 col-sm-2 col-md-2 control-label">植被名称</label>
		<div class="col-sm-8 col-lg-9 col-xs-12">
			<input type="text" class="form-control" id="vegename" value="{$item['vegename']}" name="vegename" />
		</div>
	</div>

	<div class="form-group">
		<label class="col-xs-12 col-sm-2 col-md-2 control-label"><span class="text-danger">*</span>种类</label>
		<div class="col-sm-8 col-lg-9 col-xs-12">
			<input type="text" class="form-control" id="kind" value="{$item['kind']}" name="kind" />
		</div>
	</div>

	<div class="form-group">
		<label class="col-xs-12 col-sm-2 col-md-2 control-label"><span class="text-danger">*</span>数量</label>
		<div class="col-sm-8 col-lg-9 col-xs-12">
			<input type="text" class="form-control" id="num" value="{$item['num']}" name="num" />
		</div>	
	</div>

	<div class="form-group">
		<label class="col-xs-12 col-sm-2 col-md-2 control-label">种植时间</label>
		<div class="col-sm-8 col-lg-9 col-xs-12">
			{php echo tpl_form_field_date('simdate',$item['simdate'], $withtime = true);}
		</div>	
	</div>
</form>	

<script type="text/javascript">
	var lbskey = "{$sysconifg['qq_lbskey']}";
	window._region = {php echo json_encode($myregion);};	
	window._location = {php echo json_encode($mylocation);};	
	window._building = {php echo json_encode($mybuilding);};
	window._unit = {php echo json_encode($myunit);};
	window._headper = {php echo json_encode($myheadper);};
	function renderCategory(obj, name,id){
		var index = obj.options[obj.selectedIndex].value;
		require(['jquery', 'util'], function($, u){
			$selectChild = $("#"+ id);
			var html = '<option value="0">请选择</option>';
			if (id=='rid'){
				$("#lid").html(html);
				$("#bid").html(html);
				$("#tid").html(html);
				$("#hid").html(html);
			}
			else if(id=='lid'){				
				$("#bid").html(html);
				$("#tid").html(html);
			}
			else if (id=='bid'){
				$("#tid").html(html);
			}

			if (!window['_'+name] || !window['_'+name][index]) {
				$selectChild.html(html);
				return false;
			}
			for(var i=0; i< window['_'+name][index].length; i++){
				html += '<option value="'+window['_'+name][index][i]['id']+'">'+window['_'+name][index][i]['title']+'</option>';
			}
			$selectChild.html(html);
		});
	}

	function changeHeader(obj, name,id){
		var index = obj.options[obj.selectedIndex].value;
		require(['jquery', 'util'], function($, u){
			$selectChild = $("#"+ id);
			var html = '<option value="0">请选择</option>';

			if (!window['_'+name] || !window['_'+name][index]) {
				$selectChild.html(html);
				return false;
			}
			for(var i=0; i< window['_'+name][index].length; i++){
				html += '<option value="'+window['_'+name][index][i]['id']+'">'+window['_'+name][index][i]['title']+'</option>';
			}
			$selectChild.html(html);
		});
	}
	require(['angular.sanitize','clockpicker'], function(angular, $, _){
		$('.starttime').clockpicker({autoclose: true});
		$('.endtime').clockpicker({autoclose: true});
	});
</script>