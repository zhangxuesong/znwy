{template 'common/header'}
<div ng-app="welcome" ng-controller="setting">
	<form action="" method="post" class="form-horizontal" role="form" id="form1">
		<div class="panel-heading">顶部菜单</div>
		<div class="panel-body we7-padding">
			<div class="pull-right">
				<button type="button" class="btn btn-primary" ng-click="add('nav')">添加</button>
			</div>
			<table class="table">
				<thead>
					<th>菜单名称</th>
					<th>链接</th>
					<th>操作</th>
				</thead>
				<tbody>
					<tr ng-repeat="(index, nav) in nav_list track by index">
						<td>{{ nav.title }}</td>
						<td>{{ nav.url }}</td>
						<td>
							<a href="javascript:;" ng-click="edit('nav', nav.id)">修改</a>
							<a href="{php echo $this->createWebUrl('setting', array('operate' => 'delete'))}&id={{ nav.id }}">删除</a>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="panel-heading">
			logo
			<button type="button" class="btn btn-primary" ng-click="save('logo')">保存</button>
		</div>
		<div class="panel-body we7-padding">
			{php echo tpl_form_field_image('logo', $logo['picture'])}
		</div>
		<div class="panel-heading">
			幻灯片
			<button type="button" class="btn btn-primary" ng-click="save('slide')">保存</button>
		</div>
		<div class="panel-body we7-padding">
			{php echo tpl_form_field_multi_image('slide', $slide_list['picture'])}
		</div>
		<!--<div class="panel-heading">公告</div>-->
		<!--<div class="panel-body we7-padding">-->
			<!--<div class="pull-right">-->
				<!--<button type="button" class="btn btn-primary" ng-click="add('notice')">添加</button>-->
			<!--</div>-->
			<!--<table class="table">-->
				<!--<thead>-->
				<!--<th>标题</th>-->
				<!--<th>操作</th>-->
				<!--</thead>-->
				<!--<tbody>-->
				<!--<tr ng-repeat="(index, notice) in notice_list track by index">-->
					<!--<td>{{ notice.title }}</td>-->
					<!--<td>-->
						<!--<a href="javascript:;" ng-click="edit('notice', notice.id)">修改</a>-->
						<!--<a href="{php echo $this->createWebUrl('setting', array('operate' => 'delete'))}&id={{ notice.id }}">删除</a>-->
					<!--</td>-->
				<!--</tr>-->
				<!--</tbody>-->
			<!--</table>-->
		<!--</div>-->
		<div class="panel-heading">功能模块介绍</div>
		<div class="panel-body we7-padding">
			<div class="pull-right">
				<button type="button" class="btn btn-primary" ng-click="add('module')">添加</button>
			</div>
			<table class="table">
				<thead>
				<th>模块</th>
				<th>操作</th>
				</thead>
				<tbody>
				<tr ng-repeat="(index, module) in module_list track by index">
					<td>{{ modules[module.module].title }}</td>
					<td>
						<a href="{php echo $this->createWebUrl('setting', array('operate' => 'delete'))}&id={{ module.id }}">删除</a>
					</td>
				</tr>
				</tbody>
			</table>
		</div>
		<div class="panel-heading">联系我们</div>
		<div class="panel-body we7-padding">
			<table class="table">
				<thead>
				<th>名称</th>
				<th></th>
				<th>操作</th>
				</thead>
				<tbody>
				<tr>
					<td>联系人</td>
					<td>{{ contact.person.content }}</td>
					<td>
						<a href="javascrip:;" ng-click="edit('contact', 'person')">修改</a>
					</td>
				</tr>
				<tr>
					<td>QQ</td>
					<td>{{ contact.qq.content }}</td>
					<td>
						<a href="javascrip:;" ng-click="edit('contact', 'qq')">修改</a>
					</td>
				</tr>
				<tr>
					<td>手机</td>
					<td>{{ contact.mobile.content }}</td>
					<td>
						<a href="javascrip:;" ng-click="edit('contact', 'mobile')">修改</a>
					</td>
				</tr>
				<tr>
					<td>公司</td>
					<td>{{ contact.company.content }}</td>
					<td>
						<a href="javascrip:;" ng-click="edit('contact', 'company')">修改</a>
					</td>
				</tr>
				<tr>
					<td>地址</td>
					<td>{{ contact.address.content }}</td>
					<td>
						<a href="javascrip:;" ng-click="edit('contact', 'address')">修改</a>
					</td>
				</tr>
				</tbody>
			</table>
		</div>
		<!--<div class="panel-heading">系统动态</div>-->
		<!--<div class="panel-body we7-padding">-->
			<!--<div class="pull-right">-->
				<!--<button type="button" class="btn btn-primary" ng-click="add('system')">添加</button>-->
			<!--</div>-->
			<!--<table class="table">-->
				<!--<thead>-->
				<!--<th>标题</th>-->
				<!--<th>操作</th>-->
				<!--</thead>-->
				<!--<tbody>-->
				<!--<tr ng-repeat="(index, system) in system_list track by index">-->
					<!--<td>{{ system.title }}</td>-->
					<!--<td>-->
						<!--<a href="javascrip:;" ng-click="edit('system', index)">编辑</a>-->
						<!--<a href="{php echo $this->createWebUrl('setting', array('operate' => 'delete'))}&id={{ system.id }}">删除</a>-->
					<!--</td>-->
				<!--</tr>-->
				<!--</tbody>-->
			<!--</table>-->
		<!--</div>-->
	</form>
	<div class="modal fade" id="nav" tabindex="-1" role="dialog" aria-labelledby="navLabel" style="z-index:1038">
		<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="navLabel">添加顶部菜单</h4>
			</div>
			<div class="modal-body">
				<form class="form-horizontal">

					<div class="form-group">
						<label class="col-sm-2 control-label">名称</label>
						<div class="col-sm-10">
							<input class="form-control" name="title" ng-model="buffer.nav.title">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">链接</label>
						<div class="col-sm-10">
							<input class="form-control" name="title" ng-model="buffer.nav.url">
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				<button type="button" class="btn btn-primary" ng-click="save('nav')">保存</button>
			</div>
		</div>
	</div>
	</div>
	<div class="modal fade" id="notice" tabindex="-1" role="dialog" aria-labelledby="noticeLabel" style="z-index:1038">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="noticeLabel">公告</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal">
						<div class="form-group">
							<label class="col-sm-2 control-label">名称</label>
							<div class="col-sm-10">
								<input class="form-control" name="title" ng-model="buffer.notice.title">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-2 control-label">内容</label>
							<div class="col-sm-10">
								<textarea class="form-control" ng-model="buffer.notice.content">{{ buffer.notice.content }}</textarea>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-primary" ng-click="save('notice')">保存</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="system" tabindex="-1" role="dialog" aria-labelledby="systemLabel" style="z-index:1038">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="systemLabel">系统动态</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal">
						<div class="material-body">
							<div class="row">
								<div class="form-group">
									<label class="col-sm-2 control-label">标题</label>
									<div class="col-sm-10">
										<input class="form-control" name="title" ng-model="buffer.system.title">
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label">内容</label>
									<div class="col-sm-10">
										<textarea class="form-control" ng-model="buffer.system.content">{{ buffer.system.content }}</textarea>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-primary" ng-click="save('system')">保存</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="module" tabindex="-1" role="dialog" aria-labelledby="contactLabel" style="z-index:1038">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="contactLabel">模块(点击添加)</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal">
						<div class="material-body">
							<div class="row">
								<div class="col-sm-2" ng-repeat="(index, module) in modules track by index">
									<div class="item" ng-click="addModule(module.name)">
										<img ng-src="{{ module.logo }}" style="width: 50px;height: 50px" alt="" class="icon"/>
										<div class="name">{{ module.title }}</div>
										<div class="mask">
											<span class="wi wi-right"></span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="contact" tabindex="-1" role="dialog" aria-labelledby="moduleLabel" style="z-index:1038">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="moduleLabel">联系我们</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal">
						<div class="material-body">
							<div class="row">
								<div class="form-group" ng-show="show == 'person'">
									<label class="col-sm-2 control-label">联系人</label>
									<div class="col-sm-10">
										<input class="form-control" ng-model="buffer.contact.person">
									</div>
								</div>
								<div class="form-group" ng-show="show == 'qq'">
									<label class="col-sm-2 control-label">QQ</label>
									<div class="col-sm-10">
										<input class="form-control" ng-model="buffer.contact.qq">
									</div>
								</div>
								<div class="form-group" ng-show="show == 'mobile'">
									<label class="col-sm-2 control-label">手机</label>
									<div class="col-sm-10">
										<input class="form-control" ng-model="buffer.contact.mobile">
									</div>
								</div>
								<div class="form-group" ng-show="show == 'company'">
									<label class="col-sm-2 control-label">公司</label>
									<div class="col-sm-10">
										<input class="form-control" ng-model="buffer.contact.company">
									</div>
								</div>
								<div class="form-group" ng-show="show == 'address'">
									<label class="col-sm-2 control-label">地址</label>
									<div class="col-sm-10">
										<input class="form-control" ng-model="buffer.contact.address">
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-primary" ng-click="save('contact')">保存</button>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
	angular.module('welcome', []).controller('setting', ['$scope', '$http', function($scope, $http) {
		$scope.nav_list = {php echo json_encode($nav_list)};
		$scope.notice_list = {php echo json_encode($notice_list)};
		$scope.modules = {php echo json_encode($modules)};
		$scope.module_list = {php echo json_encode($module_list)};
		$scope.system_list = {php echo json_encode($system_list)};
		$scope.contact = {php echo json_encode($contact)};
		if ($scope.contact == null) {
			$scope.contact = {};
		}
		$scope.buffer = {
			'nav' : {'title' : '', 'url' : ''},
			'notice' : {'title' : '', 'content' : ''},
			'contact' : {'type' : ''}
		};
		$scope.show = '';

		$scope.add = function(type) {
			$('#' + type).modal('show');
			if (type == 'nav') {
				$scope.buffer.nav = {'title' : '', 'url' : ''};
			}
			if (type == 'notice') {
				$scope.buffer.notice = {'title' : '', 'content' : ''};
			}
			if (type == 'system') {
				$scope.buffer.system = {'title' : '', 'content' : ''};
			}
		};

		$scope.edit = function(type, id) {
			if (type == 'nav') {
				$scope.buffer.nav = $scope.nav_list[id];
			}
			if (type == 'notice') {
				$scope.buffer.notice = $scope.notice_list[id];
			}
			if (type == 'system') {
				$scope.buffer.system = $scope.system_list[id];
			}
			if (type == 'contact') {
				$scope.show = id;
				$scope.buffer.contact.type = id;
				if ( $scope.contact[id] == undefined) {
					$scope.contact[id] = '';
				}
				$scope.buffer.contact[id] = $scope.contact[id].content;
			}
			$('#' + type).modal('show');
		};

		$scope.addModule = function(module) {
			$scope.buffer.module = module;
			$scope.save('module');
		}

		$scope.save = function(type) {
			if (type == 'nav') {
				if ($scope.buffer.nav.title == '') {
					util.message('请填写名称');
					return false;
				}
				if ($scope.buffer.nav.url == '') {
					util.message('请填写导航链接');
					return false;
				}
			}
			if (type == 'notice') {
				if ($scope.buffer.notice.title == '') {
					util.message('请填写标题');
					return false;
				}
				if ($scope.buffer.notice.content == '') {
					util.message('请填写内容');
					return false;
				}
			}
			if (type == 'slide') {
				$scope.buffer.slide = [];
				$('[name="slide[]"]').each(function(key, val) {
					$scope.buffer.slide.push(val.value);
				})
			}
			if (type == 'logo') {
				$scope.buffer.logo = $('[name="logo"]').val();
			}
			if (type == 'system') {
				if ($scope.buffer.system.title == '') {
					util.message('请填写标题');
					return false;
				}
				if ($scope.buffer.system.content == '') {
					util.message('请填写内容');
					return false;
				}
			}
			$http.post("{php echo $this->createWebUrl('setting', array('operate' => 'save', 'module_type' => 'system_welcome'))}", {'type' : type, 'buffer' : $scope.buffer}).success(function(data) {
				if (data.message.errno == 0) {
					util.message('保存成功', '', 'success');
					$('#myModal').modal('hide');
					location.reload();
				} else {
					util.message('保存失败', '', 'error');
				}
				return false;
			});
		}
	}]);
</script>
{template 'common/footer'}